---
title: æ‹–æ‹½
excerpt: å¯æ‹–æ‹½å…ƒç´ æ˜¯HTML5çš„æ–°ç‰¹æ€§ï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥å¯¹é¡µé¢ä¸Šä»»æ„ä¸€ä¸ªå…ƒç´ è¿›è¡Œæ‹–æ‹½
toc: true
tag: HTML
categories:
- å‰ç«¯
- HTML
---

## 1.draggableå±æ€§
ç°ä»£æµè§ˆå™¨ä¸­ï¼Œå›¾ç‰‡æ ‡ç­¾æ˜¯å¯ä»¥è¢«é•¿æŒ‰æ‹–æ‹½çš„ï¼Œå¦‚æœéœ€è¦è®©è‡ªå®šä¹‰DOMèŠ‚ç‚¹å¯ä»¥è¢«æ‹–æ‹½ï¼Œéœ€è¦é…ç½®`draggable`å…¨å±€æ ‡ç­¾å±æ€§
å½“å…ƒç´ è®¾ç½®çš„draggableå±æ€§ï¼Œå°±å¯ä»¥è¢«è‡ªç”±æ‹–æ‹½äº†
## 2.Drag & Dropäº‹ä»¶
HTML çš„ drag & drop ä½¿ç”¨äº†â€œ**DOM Event**â€å’Œä»â€œ**Mouse Event**â€ç»§æ‰¿è€Œæ¥çš„â€œ**drag event**â€
**ä¸€ä¸ªå…¸å‹çš„æ‹–æ‹½æ“ä½œï¼š** ç”¨æˆ·é€‰ä¸­ä¸€ä¸ªå¯æ‹–æ‹½çš„ï¼ˆdraggableï¼‰å…ƒç´ ï¼Œå¹¶å°†å…¶æ‹–æ‹½ï¼ˆé¼ æ ‡æŒ‰ä½ä¸æ”¾ï¼‰è‡³ä¸€ä¸ªå¯æ”¾ç½®çš„ï¼ˆdroppableï¼‰å…ƒç´ ä¸Šï¼Œç„¶åæ¾å¼€é¼ æ ‡ã€‚
åœ¨æ‹–åŠ¨å…ƒç´ æœŸé—´ï¼Œä¸€äº›ä¸æ‹–æ”¾ç›¸å…³çš„äº‹ä»¶ä¼šè¢«è§¦å‘ï¼Œåƒ drag å’Œ dragover ç±»å‹çš„äº‹ä»¶ä¼šè¢«é¢‘ç¹è§¦å‘ã€‚
é™¤äº†å®šä¹‰æ‹–æ‹½äº‹ä»¶ç±»å‹ï¼Œæ¯ä¸ªäº‹ä»¶ç±»å‹è¿˜èµ‹äºˆäº†å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨

| äº‹ä»¶ç±»å‹ | äº‹ä»¶å¤„ç†å™¨ | è§¦å‘æ—¶æœº | ç»‘å®šå…ƒç´  |
| --- | --- | --- | --- |
| dragstart | ondragstart | å½“å¼€å§‹æ‹–åŠ¨ä¸€ä¸ªå…ƒç´ æ—¶ | æ‹–æ‹½ |
| drag | ondrag | å½“å…ƒç´ è¢«æ‹–åŠ¨æœŸé—´æŒ‰ä¸€å®šé¢‘ç‡è§¦å‘ | æ‹–æ‹½ |
| dragend | ondragend | å½“æ‹–åŠ¨çš„å…ƒç´ è¢«é‡Šæ”¾ï¼ˆğŸ–±ï¸æ¾å¼€ã€æŒ‰é”®ç›˜ ESCï¼‰æ—¶ | æ‹–æ‹½ |
| dragenter | ondragenter | å½“æ‹–åŠ¨å…ƒç´ åˆ°ä¸€ä¸ªå¯é‡Šæ”¾ç›®æ ‡å…ƒç´ æ—¶ | æ”¾ç½® |
| dragover | ondragover | å½“å…ƒç´ è¢«æ‹–åˆ°ä¸€ä¸ªå¯é‡Šæ”¾ç›®æ ‡å…ƒç´ ä¸Šæ—¶ï¼ˆ100 ms/æ¬¡ï¼‰ | æ”¾ç½® |
| dragexit | ondragexit | å½“å…ƒç´ å˜å¾—ä¸å†æ˜¯æ‹–åŠ¨æ“ä½œçš„é€‰ä¸­ç›®æ ‡æ—¶ | æ”¾ç½® |
| dragleave | ondragleave | å½“æ‹–åŠ¨å…ƒç´ ç¦»å¼€ä¸€ä¸ªå¯é‡Šæ”¾ç›®æ ‡å…ƒç´  | æ”¾ç½® |
| drop | ondrop | å½“æ‹–åŠ¨å…ƒç´ åœ¨å¯é‡Šæ”¾ç›®æ ‡å…ƒç´ ä¸Šé‡Šæ”¾æ—¶ | æ”¾ç½® |

å„ä¸ªäº‹ä»¶çš„æ—¶æœºå¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªå›¾ç®€å•è¡¨ç¤ºï¼š
![image.png](https://cdn.nlark.com/yuque/0/2022/png/26434275/1662172588600-903f7bb8-9ccd-4d02-9879-5c55d032479b.png#averageHue=%23fafafa&clientId=ue1ca1322-96a7-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=674&id=u562b56cd&margin=%5Bobject%20Object%5D&name=image.png&originHeight=674&originWidth=936&originalType=binary&ratio=1&rotation=0&showTitle=false&size=116394&status=done&style=none&taskId=uf999364e-978e-4062-8b1c-9d082401da5&title=&width=936)
**âš ï¸æ³¨æ„ï¼š** [dragOver](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FDocument%2Fdragover_event) äº‹ä»¶çš„é»˜è®¤è¡Œä¸ºæ˜¯ï¼šâ€œReset the current drag operation to "none"â€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸é˜»æ­¢æ”¾ç½®å…ƒç´ çš„ dragOver äº‹ä»¶ï¼Œåˆ™æ”¾ç½®å…ƒç´ ä¸ä¼šå“åº”â€œæ‹–åŠ¨å…ƒç´ â€çš„â€œæ”¾ç½®è¡Œä¸ºâ€
## 3.DataTransfer
åœ¨ä¸Šè¿°çš„äº‹ä»¶ç±»å‹ä¸­ï¼Œä¸éš¾å‘ç°ï¼Œæ”¾ç½®å…ƒç´ å’Œæ‹–åŠ¨å…ƒç´ åˆ†åˆ«ç»‘å®šäº†è‡ªå·±çš„äº‹ä»¶ï¼Œå¯å¦‚ä½•å°†æ‹–æ‹½å…ƒç´ å’Œæ”¾ç½®å…ƒç´ **å»ºç«‹è”ç³»**ä»¥åŠ**ä¼ é€’æ•°æ®**ï¼Ÿ
è¿™å°±æ¶‰åŠåˆ° DataTransfer å¯¹è±¡ï¼š
DataTransfer å¯¹è±¡ç”¨äºä¿å­˜æ‹–åŠ¨å¹¶æ”¾ä¸‹ï¼ˆdrag and dropï¼‰è¿‡ç¨‹ä¸­çš„æ•°æ®ã€‚å®ƒå¯ä»¥ä¿å­˜ä¸€é¡¹æˆ–å¤šé¡¹æ•°æ®ï¼Œè¿™äº›æ•°æ®é¡¹å¯ä»¥æ˜¯ä¸€ç§æˆ–è€…å¤šç§æ•°æ®ç±»å‹ã€‚ â€”â€” [DataTransfer - MDN](https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FDataTransfer)
### (1) å±æ€§
| å±æ€§ | è¯´æ˜ |
| --- | --- |
| dropEffect | è·å–å½“å‰é€‰å®šçš„æ‹–æ”¾æ“ä½œç±»å‹æˆ–è€…è®¾ç½®çš„ä¸ºä¸€ä¸ªæ–°çš„ç±»å‹ã€‚å€¼ä¸ºï¼šnoneã€copyã€linkã€move |
| effectAllowed | æä¾›æ‰€æœ‰å¯ç”¨çš„æ“ä½œç±»å‹ã€‚å€¼æ˜¯ï¼šnoneã€copyã€copyLinkã€copyMoveã€linkã€linkMoveã€moveã€allã€uninitialized |
| files | åŒ…å«æ•°æ®ä¼ è¾“ä¸­å¯ç”¨çš„æ‰€æœ‰æœ¬åœ°æ–‡ä»¶çš„åˆ—è¡¨ã€‚å¦‚æœæ‹–åŠ¨æ“ä½œä¸æ¶‰åŠæ‹–åŠ¨æ–‡ä»¶ï¼Œåˆ™æ­¤å±æ€§ä¸ºç©ºåˆ—è¡¨ |
| items (åªè¯») | æä¾›ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ‹–åŠ¨æ•°æ®åˆ—è¡¨çš„ DataTransferItemList å¯¹è±¡ |
| types (åªè¯») | æä¾›ä¸€ä¸ª dragstart äº‹ä»¶ä¸­è®¾ç½®çš„æ ¼å¼çš„ strings æ•°ç»„ã€‚ |

### (2) æ–¹æ³•
| å±æ€§ | è¯´æ˜ |
| --- | --- |
| setData(format, value) | è®¾ç½®ç»™å®šç±»å‹çš„æ•°æ®ã€‚å¦‚æœè¯¥ç±»å‹çš„æ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™å°†å…¶æ·»åŠ åˆ°æœ«å°¾ï¼Œä»¥ä¾¿ç±»å‹åˆ—è¡¨ä¸­çš„æœ€åä¸€é¡¹å°†æ˜¯æ–°çš„æ ¼å¼ã€‚å¦‚æœè¯¥ç±»å‹çš„æ•°æ®å·²ç»å­˜åœ¨ï¼Œåˆ™åœ¨ç›¸åŒä½ç½®æ›¿æ¢ç°æœ‰æ•°æ®ã€‚ |
| getData(format) | æ£€ç´¢ç»™å®šç±»å‹çš„æ•°æ®ï¼Œå¦‚æœè¯¥ç±»å‹çš„æ•°æ®ä¸å­˜åœ¨æˆ– data transfer ä¸åŒ…å«æ•°æ®ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸² |
| clearData([format]) | åˆ é™¤ä¸ç»™å®šç±»å‹å…³è”çš„æ•°æ®ã€‚ç±»å‹å‚æ•°æ˜¯å¯é€‰çš„ã€‚å¦‚æœç±»å‹ä¸ºç©ºæˆ–æœªæŒ‡å®šï¼Œåˆ™åˆ é™¤ä¸æ‰€æœ‰ç±»å‹å…³è”çš„æ•°æ®ã€‚å¦‚æœæŒ‡å®šç±»å‹çš„æ•°æ®ä¸å­˜åœ¨ï¼Œæˆ–è€… data transfer ä¸­ä¸åŒ…å«ä»»ä½•æ•°æ®ï¼Œåˆ™è¯¥æ–¹æ³•ä¸ä¼šäº§ç”Ÿä»»ä½•æ•ˆæœã€‚ |
| setDragImage(img,element, xOffset, yOffset) | è®¾ç½®è‡ªå®šä¹‰çš„æ‹–åŠ¨å›¾åƒï¼Œæ³¨æ„å›¾åƒéœ€è¦æå‰åŠ è½½ï¼Œå¦åˆ™ä¼šæ— æ•ˆ |

## 4.æ‰‹å†™ä¸€ä¸ªæ‹–æ‹½åˆ—è¡¨
### vue
```vue
<script setup lang="ts">
import { ref } from 'vue'

const MOCK_LIST_DATA = new Array(10).fill(0).map((_, index) => ({
  id: Math.random().toString(36).slice(-6),
  val: `åˆå§‹é¡ºåº: ${index}`
}))

const mockListData = ref(MOCK_LIST_DATA);
const dragId = ref("");

// æ›¿æ¢æ•°æ®
const move = (dragId: string, dropId: string) => {
  if (!dragId || !dropId) return;
  const dragIndex = mockListData.value.findIndex(item => item.id === dragId);
  const dropIndex = mockListData.value.findIndex(item => item.id === dropId);

  const originData = mockListData.value.splice(dragIndex, 1)[0];

  mockListData.value.splice(dropIndex, 0, originData);

}
// æ‹–æ‹½å¼€å§‹æ—¶
const onDragStart = (e) => {
  dragId.value = e.currentTarget.dataset.id;
}
// æ‹–æ‹½è¿›è¡Œä¸­
const onDrag = (e) => {
  e.currentTarget.style.opacity = "0";
}
// æ‹–æ‹½ç»“æŸ
const onDragEnd = (e) => {
  e.currentTarget.style.opacity = "1"
}
// å½“ç§»åŠ¨åˆ°å¯ä»¥è¢«æ”¾ç½®çš„å…ƒç´ æ—¶
const onDragOver = (e) => {
  const dropId = e.currentTarget.dataset.id;
  if (dragId === dropId) return;

  const dragIndex = mockListData.value.findIndex(item => item.id === dragId.value);
  const dropIndex = mockListData.value.findIndex(item => item.id === dropId);
  e.currentTarget.classList.remove("drop-up", "drop-down");
  if (dragIndex < dropIndex) {
    e.currentTarget.classList.add("drop-down");
  } else if (dragIndex > dropIndex) {
    e.currentTarget.classList.add("drop-up");
  }
  move(dragId.value, dropId);
}
</script>

<template>
  <div class="sortable-page">
    <h1>åŸºäº HTML5 åŸç”Ÿæ‹–æ‹½äº‹ä»¶çš„æ‹–æ‹½åˆ—è¡¨</h1>
    <div className="list-container">
      <div @dragstart="onDragStart" @drag="onDrag" @dragend="onDragEnd" @dragover.prevent="onDragOver" class="item"
        v-for="item in mockListData" :key="item.id" :data-id="item.id" draggable="true">
        <div>ID: {{ item.id }}</div>
        <div> {{ item.val }}</div>
      </div>
    </div>
  </div>
</template>

<style scoped lang="scss">
.sortable-page {
  position: relative;
  width: 100%;
  min-height: 100vh;
  background-color: #ececec;
  display: flex;
  align-items: center;
  flex-direction: column;
  justify-content: center;

  &>.list-container {
    margin: 40px auto;
    width: 400px;
    min-height: 600px;
    padding: 10px 20px;
    background-color: #fff;
    border-radius: 4px;
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;

    .item {
      position: relative;
      box-sizing: border-box;
      height: 50px;
      padding: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #fff;
      cursor: grab;
      user-select: none;

      &.drop-up {
        animation: dropUp 0.3s ease-in-out forwards;
      }

      &.drop-down {
        animation: dropDown 0.3s ease-in-out forwards;
      }

      &.border-top {
        border-top: 2px solid red;
      }
    }
  }
}

@keyframes dropUp {
  100% {
    transform: translateY(5px);
  }
}

@keyframes dropDown {
  100% {
    transform: translateY(-5px);
  }
}
</style>

```
### react
```tsx
import React, { useState } from "react";
import { cloneDeep, findIndex, isEqual } from "lodash-es";
import update from "immutability-helper";
import "./App.less";

const MOCK_LIST_DATA = new Array(10).fill(0).map((_, idx) => ({
  id: Math.random().toString(36).slice(-6),
  val: `åˆå§‹é¡ºåºï¼š${idx}`,
}));

interface ItemProps {
  index: string;
  val: string;
  handleDragStart: React.DragEventHandler<HTMLDivElement>;
  handleDragOver: React.DragEventHandler<HTMLDivElement>;
  handleDrag: React.DragEventHandler<HTMLDivElement>;
  handleDragEnd: React.DragEventHandler<HTMLDivElement>;
}

const Item: React.FC<ItemProps> = React.memo((props) => {
  const {
    index,
    val,
    handleDrag,
    handleDragEnd,
    handleDragOver,
    handleDragStart,
  } = props;

  return (
    <div
      className="item"
      draggable
      onDragStart={handleDragStart}
      onDragOver={handleDragOver}
      onDrag={handleDrag}
      onDragEnd={handleDragEnd}
      onDragLeave={(e) => {
        e.currentTarget.classList.remove("border-top");
      }}
      data-index={index}
    >
      <div>ID: {index}</div>
      <div>{val}</div>
    </div>
  );
});

const SortableListPage = () => {
  const [listData, setListData] = useState(MOCK_LIST_DATA);
  const [dragId, setDragId] = useState<string | undefined>("");

  const move = (dragId?: string, dropId?: string) => {
    if (!dragId || !dropId) return;
    const dragIndex = findIndex(listData, (i) => i.id === dragId);
    const dropIndex = findIndex(listData, (i) => i.id === dropId);

    const originItem = listData.splice(dragIndex, 1)[0];
    listData.splice(dropIndex, 0, originItem);

    setListData([...listData]);
  };

  // æºå¯¹è±¡å¼€å§‹æ‹–æ‹½
  const handleDragStart = (e: React.DragEvent<HTMLDivElement>) => {
    e.dataTransfer.effectAllowed = "move";
    setDragId(e.currentTarget.dataset.index);
  };

  // æºå¯¹è±¡åœ¨ç›®æ ‡å¯¹è±¡ä¸Šæ–¹æ—¶
  const handleDragOver = (e: React.DragEvent<HTMLDivElement>) => {
    e.preventDefault(); // å…è®¸æ”¾ç½®ï¼Œé˜»æ­¢é»˜è®¤äº‹ä»¶
    // è®¾ç½®åŠ¨ç”»
    const dropId = e.currentTarget.dataset.index;

    if(dragId === dropId) return;

    const dragIndex = findIndex(listData, (i) => i.id === dragId);
    const dropIndex = findIndex(listData, (i) => i.id === dropId);
    e.currentTarget.classList.remove("drop-up", "drop-down");
    if (dragIndex < dropIndex) {
      e.currentTarget.classList.add("drop-down");
    } else if (dragIndex > dropIndex) {
      e.currentTarget.classList.add("drop-up");
    }

    move(dragId, dropId);
  };

  // æºå¯¹è±¡è¢«æ‹–æ‹½è¿‡ç¨‹ä¸­
  const handleDrag = (e: React.DragEvent<HTMLDivElement>) => {
    e.currentTarget.style.opacity = "0";
  };

  // æºå¯¹è±¡è¢«æ”¾ç½®å®Œæˆæ—¶
  const handleDragEnd = (e: React.DragEvent<HTMLDivElement>) => {
    e.currentTarget.style.opacity = "1";
  };

  return (
    <div className="sortable-page">
      <h1>åŸºäº HTML5 åŸç”Ÿæ‹–æ‹½äº‹ä»¶çš„æ‹–æ‹½åˆ—è¡¨</h1>
      <div className="list-container">
        {listData.map((i) => (
          <Item
            key={i.id}
            index={i.id}
            val={i.val}
            handleDragStart={handleDragStart}
            handleDragOver={handleDragOver}
            handleDrag={handleDrag}
            handleDragEnd={handleDragEnd}
          />
        ))}
      </div>
    </div>
  );
};

export default SortableListPage;
```
```less
.sortable-page {
  position: relative;
  width: 100%;
  min-height: 100vh;
  background-color: #ececec;
  display: flex;
  align-items: center;
  flex-direction: column;
  justify-content: center;

  & > .list-container {
    margin: 40px auto;
    width: 400px;
    min-height: 600px;
    padding: 10px 20px;
    background-color: #fff;
    border-radius: 4px;
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;

    .item {
      position: relative;
      box-sizing: border-box;
      height: 50px;
      padding: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #fff;
      cursor: grab;
      user-select: none;

      &.drop-up {
        animation: dropUp 0.3s ease-in-out forwards;
      }
      &.drop-down {
        animation: dropDown 0.3s ease-in-out forwards;
      }

      &.border-top {
        border-top: 2px solid red;
      }
    }
  }
}

@keyframes dropUp {
  100% {
    transform: translateY(5px);
  }
}

@keyframes dropDown {
  100% {
    transform: translateY(-5px);
  }
}

```
### React-dnd
```bash
yarn add react-dnd react-dnd-html5-backend
```
```tsx
import { DndProvider } from 'react-dnd';
import { HTML5Backend } from 'react-dnd-html5-backend';

// App.tsx
function App() {
  return (
    <DndProvider backend={ HTML5Backend }>
        <Demo />
    </DndProvider>
  )
}

// Demo.tsx
import React, { useState, useRef } from "react";
import { useDrag, useDrop } from "react-dnd";

const mockData = new Array(10).fill(0).map((_, index) => ({
  id: Math.random().toString(36).slice(-6),
  val: `åˆå§‹ä½ç½®: ${index}`,
}));

const Item = ({ val, id, move }: any) => {
  const ref = useRef<HTMLDivElement>(null);
  const [, drag, dragPreview] = useDrag({
    type: "Item",
    item: () => ({
      id,
    }),
  });

  const [, drop] = useDrop({
    accept: "Item",
    hover: (item: any, monitor) => {
      const dragId = item.id;
      const dropId = id;

      if (dragId === dropId) return;
      move(dragId, dropId)
    },

  });

  dragPreview(drag(drop(ref)));

  return (
    <div
      ref={ref}
      style={{
        width: "200px",
        lineHeight: "40px",
        cursor: "grab",
        display: "flex",
        alignItems: "center",
        justifyContent: "space-between",
      }}
    >
      <div>ID: {id}</div>
      <div>{val}</div>
    </div>
  );
};

function Demo() {
  const [dataList, setDataList] = useState(mockData);

  const move = (dragId: string, dropId: string) => {
    const dragIndex = dataList.findIndex((item) => item.id === dragId);
    const dropIndex = dataList.findIndex((item) => item.id === dropId);
    const originData = dataList.splice(dragIndex, 1)[0];
    dataList.splice(dropIndex, 0, originData);

    setDataList([...dataList]);
  };

  return (
    <>
      {dataList.map((item) => (
        <Item key={item.id} id={item.id} val={item.val} move={move} />
      ))}
    </>
  );
}

export default Demo;

```

